# Fuploader 平台支持问题分析报告

## 问题现象

前端显示了7个平台选项（抖音、视频号、快手、TikTok、Bilibili、小红书、百家号），但实际上**只有抖音平台真正实现了上传功能**，其他平台虽然可以选择，但上传时会报错。

---

## 原因分析

### 1. 前端配置了7个平台

**文件**: `frontend/src/types/account.ts:8-16`

```typescript
export const PLATFORM_CONFIG: Record<PlatformType, { name: string; icon: string; color: string }> = {
  douyin: { name: '抖音', icon: 'VideoCamera', color: '#000000' },
  tencent: { name: '视频号', icon: 'ChatDotRound', color: '#07C160' },
  kuaishou: { name: '快手', icon: 'Orange', color: '#FF6600' },
  tiktok: { name: 'TikTok', icon: 'VideoPlay', color: '#000000' },
  bilibili: { name: 'Bilibili', icon: 'VideoPlay', color: '#FB7299' },
  xiaohongshu: { name: '小红书', icon: 'Notebook', color: '#FF2442' },
  baijiahao: { name: '百家号', icon: 'Document', color: '#2932E1' }
}
```

### 2. 后端常量定义了7个平台

**文件**: `internal/config/constants.go:8-26`

```go
const (
    PlatformDouyin      = "douyin"
    PlatformTencent     = "tencent"
    PlatformKuaishou    = "kuaishou"
    PlatformTiktok      = "tiktok"
    PlatformBilibili    = "bilibili"
    PlatformXiaohongshu = "xiaohongshu"
    PlatformBaijiahao   = "baijiahao"
)

var SupportedPlatforms = []string{
    PlatformDouyin,
    PlatformTencent,
    PlatformKuaishou,
    PlatformTiktok,
    PlatformBilibili,
    PlatformXiaohongshu,
    PlatformBaijiahao,
}
```

### 3. 但实际上只实现了抖音的上传器

**目录结构**:
```
internal/platform/
└── douyin/
    └── uploader.go    # ✅ 只有抖音实现了上传器
```

### 4. 上传服务只支持抖音

**文件**: `internal/service/upload.go:196-209`

```go
var uploader types.Uploader
switch task.Platform {
case config.PlatformDouyin:
    uploader = douyin.NewUploader(task.Account.CookiePath)
default:
    // ❌ 其他平台都会报错：unsupported platform
    s.updateTaskFailed(taskID, "unsupported platform")
    s.eventBus.Publish(config.EventUploadError, types.UploadErrorEvent{
        TaskID:   task.ID,
        Platform: task.Platform,
        Error:    "unsupported platform",
        CanRetry: false,
    })
    return
}
```

---

## 问题总结

| 平台 | 前端显示 | 后端常量 | 实际上传支持 | 状态 |
|------|---------|---------|-------------|------|
| 抖音 (douyin) | ✅ | ✅ | ✅ | **可用** |
| 视频号 (tencent) | ✅ | ✅ | ❌ | 仅UI |
| 快手 (kuaishou) | ✅ | ✅ | ❌ | 仅UI |
| TikTok (tiktok) | ✅ | ✅ | ❌ | 仅UI |
| Bilibili | ✅ | ✅ | ❌ | 仅UI |
| 小红书 (xiaohongshu) | ✅ | ✅ | ❌ | 仅UI |
| 百家号 (baijiahao) | ✅ | ✅ | ❌ | 仅UI |

---

## 为什么只实现了抖音？

1. **抖音是国内主流短视频平台**，用户基数大
2. **抖音创作者平台有网页版**，可以通过 Playwright 自动化
3. **其他平台的实现需要**：
   - 分析各自平台的网页上传接口
   - 编写对应的 uploader 实现
   - 处理各平台的登录认证流程
   - 适配各平台的表单字段

---

## 修复建议

### 方案1：暂时隐藏未实现的平台（推荐）

**文件**: `frontend/src/types/account.ts`

```typescript
// 只保留已实现的抖音平台
export type PlatformType = 'douyin'

export const PLATFORM_CONFIG: Record<PlatformType, { name: string; icon: string; color: string }> = {
  douyin: { name: '抖音', icon: 'VideoCamera', color: '#000000' }
}
```

**文件**: `internal/config/constants.go`

```go
var SupportedPlatforms = []string{
    PlatformDouyin,  // 只保留抖音
}
```

### 方案2：添加平台不支持提示

在上传时给出友好提示：

```go
default:
    s.updateTaskFailed(taskID, fmt.Sprintf("平台 '%s' 暂不支持上传，目前仅支持抖音", task.Platform))
    // ...
```

### 方案3：实现其他平台的上传器（长期）

为每个平台创建对应的 uploader：

```
internal/platform/
├── douyin/
│   └── uploader.go
├── tencent/      # 视频号
│   └── uploader.go
├── kuaishou/     # 快手
│   └── uploader.go
├── tiktok/       # TikTok
│   └── uploader.go
├── bilibili/     # B站
│   └── uploader.go
├── xiaohongshu/  # 小红书
│   └── uploader.go
└── baijiahao/    # 百家号
    └── uploader.go
```

---

## 结论

**当前状态**: 前端显示7个平台，但后端只实现了抖音的上传功能，其他平台选择后上传会失败。

**建议**: 暂时隐藏未实现的平台，避免用户混淆。等后续实现其他平台的上传器后再开放。
