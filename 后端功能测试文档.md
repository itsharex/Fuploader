# Fuploader 后端功能测试文档

## 测试目标

验证后端各功能模块是否正常工作，包括数据库操作、平台上传、账号管理等。

---

## 一、测试环境准备

### 1.1 启动应用

```powershell
# 进入构建目录
cd build/bin

# 运行应用
.\Fuploader.exe
```

### 1.2 检查日志输出

查看控制台输出，确认应用启动成功：
- ✅ "Application started successfully"
- ❌ 任何错误信息

---

## 二、数据库功能测试

### 2.1 数据库初始化测试

**测试步骤**:
1. 首次运行应用
2. 检查 `storage/` 目录结构

**预期结果**:
```
storage/
├── data.db          # 数据库文件（不是目录！）
├── cookies/         # Cookie 存储目录
├── logs/            # 日志目录
├── videos/          # 视频存储目录
└── thumbnails/      # 缩略图目录
```

**验证命令**:
```powershell
Get-ChildItem storage -Recurse
```

### 2.2 账号管理测试

#### 2.2.1 添加账号

**操作**: 前端点击"添加账号"

**输入**:
- 平台: 抖音
- 账号名称: "测试账号1"

**预期结果**:
- ✅ 账号添加成功
- ✅ 数据库中新增记录
- ✅ Cookie 路径自动生成

**验证**:
```powershell
# 使用 SQLite 工具查看数据库
sqlite3 storage/data.db "SELECT * FROM accounts;"
```

#### 2.2.2 获取账号列表

**操作**: 进入账号管理页面

**预期结果**:
- ✅ 显示已添加的账号
- ✅ 状态显示正确（默认"无效"）

#### 2.2.3 删除账号

**操作**: 点击删除按钮

**预期结果**:
- ✅ 账号从列表移除
- ✅ 数据库记录删除

### 2.3 视频管理测试

#### 2.3.1 添加视频

**操作**: 选择视频文件

**预期结果**:
- ✅ 视频信息正确读取（时长、分辨率等）
- ✅ 视频文件复制到 storage/videos/

#### 2.3.2 更新视频信息

**操作**: 编辑视频标题、描述、标签

**预期结果**:
- ✅ 信息保存成功
- ✅ 数据库记录更新

---

## 三、平台上传功能测试

### 3.1 抖音平台测试

#### 3.1.1 账号登录

**前置条件**: 已添加抖音账号

**操作**: 点击"登录"按钮

**预期结果**:
- ✅ 浏览器窗口弹出
- ✅ 打开抖音创作者平台
- ✅ 5分钟等待时间用于手动登录（自动检测登录状态）
- ✅ Cookie 保存成功

**验证**:
```powershell
# 检查 Cookie 文件是否存在
Get-ChildItem storage/cookies/ -Filter "douyin_*.json"
```

#### 3.1.2 账号验证

**前置条件**: 已登录并保存 Cookie

**操作**: 点击"验证"按钮

**预期结果**:
- ✅ 状态变为"有效"
- ✅ 验证通过提示

#### 3.1.3 视频上传

**前置条件**: 
- 已添加视频
- 账号状态为"有效"

**操作**: 创建上传任务

**预期结果**:
- ✅ 任务创建成功
- ✅ 浏览器自动打开
- ✅ 视频上传完成
- ✅ 任务状态变为"成功"

### 3.2 其他平台测试

#### 3.2.1 视频号 (tencent)

**操作**: 尝试上传视频到视频号

**预期结果**:
- ✅ 上传成功
- ✅ 视频发布到视频号平台

**实现状态**: ✅ 已实现

#### 3.2.2 快手 (kuaishou)

**操作**: 尝试上传视频到快手

**预期结果**:
- ✅ 上传成功
- ✅ 视频发布到快手平台

**实现状态**: ✅ 已实现

#### 3.2.3 TikTok

**操作**: 尝试上传视频到 TikTok

**预期结果**:
- ✅ 上传成功
- ✅ 视频发布到 TikTok 平台

**实现状态**: ✅ 已实现

#### 3.2.4 Bilibili

**操作**: 尝试上传视频到 Bilibili

**预期结果**:
- ❌ 上传失败
- ❌ 错误提示: "unsupported platform"

**说明**: Bilibili 使用 API 方式，需要单独实现

#### 3.2.5 小红书 (xiaohongshu)

**操作**: 尝试上传视频到小红书

**预期结果**:
- ✅ 上传成功
- ✅ 视频发布到小红书平台

**实现状态**: ✅ 已实现

#### 3.2.6 百家号 (baijiahao)

**操作**: 尝试上传视频到百家号

**预期结果**:
- ✅ 上传成功（带重试机制）
- ✅ 视频发布到百家号平台

**实现状态**: ✅ 已实现

---

## 四、调度功能测试

### 4.1 定时发布测试

**操作**: 设置定时发布任务

**预期结果**:
- ✅ 任务状态为"待发布"
- ✅ 到达指定时间后自动上传

### 4.2 任务取消测试

**操作**: 取消待发布的任务

**预期结果**:
- ✅ 任务状态变为"已取消"
- ✅ 不会执行上传

### 4.3 任务重试测试

**操作**: 对失败的任务点击"重试"

**预期结果**:
- ✅ 任务重新执行
- ✅ 重试次数+1

---

## 五、错误处理测试

### 5.1 数据库连接失败

**测试方法**: 删除或锁定数据库文件

**预期结果**:
- ❌ 应用启动失败
- ❌ 错误信息: "Database init failed"

### 5.2 浏览器未安装

**测试方法**: 删除 .local-browsers 目录

**预期结果**:
- ⚠️ 首次上传时自动下载浏览器
- 或 ❌ 上传失败并提示浏览器未安装

### 5.3 Cookie 失效

**测试方法**: 删除 Cookie 文件后验证账号

**预期结果**:
- ⚠️ 验证失败
- ✅ 状态变为"无效"
- ✅ 提示重新登录

---

## 六、性能测试

### 6.1 大量账号测试

**操作**: 添加 50+ 个账号

**预期结果**:
- ✅ 列表加载正常
- ✅ 无卡顿

### 6.2 大量视频测试

**操作**: 添加 100+ 个视频

**预期结果**:
- ✅ 列表加载正常
- ✅ 分页或虚拟滚动正常工作

### 6.3 并发上传测试

**操作**: 同时创建多个上传任务

**预期结果**:
- ✅ 任务按顺序执行（并发数限制为2）
- ✅ 无冲突或死锁

---

## 七、测试结果记录表

| 测试项 | 测试日期 | 测试结果 | 备注 |
|--------|---------|---------|------|
| 数据库初始化 | | ⬜ 通过 ⬜ 失败 | |
| 添加账号 | | ⬜ 通过 ⬜ 失败 | |
| 获取账号列表 | | ⬜ 通过 ⬜ 失败 | |
| 删除账号 | | ⬜ 通过 ⬜ 失败 | |
| 添加视频 | | ⬜ 通过 ⬜ 失败 | |
| 抖音登录 | | ⬜ 通过 ⬜ 失败 | |
| 抖音验证 | | ⬜ 通过 ⬜ 失败 | |
| 抖音上传 | | ⬜ 通过 ⬜ 失败 | |
| 视频号上传 | | ⬜ 通过 ⬜ 失败 | ✅ 已实现 |
| 快手上传 | | ⬜ 通过 ⬜ 失败 | ✅ 已实现 |
| TikTok上传 | | ⬜ 通过 ⬜ 失败 | ✅ 已实现 |
| Bilibili上传 | | ⬜ 通过 ⬜ 失败 | ❌ 未实现 |
| 小红书上上传 | | ⬜ 通过 ⬜ 失败 | ✅ 已实现 |
| 百家号上传 | | ⬜ 通过 ⬜ 失败 | ✅ 已实现 |
| 定时发布 | | ⬜ 通过 ⬜ 失败 | |
| 任务取消 | | ⬜ 通过 ⬜ 失败 | |
| 任务重试 | | ⬜ 通过 ⬜ 失败 | |

---

## 八、已知问题汇总

### 8.1 功能缺失

| 问题 | 严重程度 | 说明 |
|------|---------|------|
| Bilibili 未实现 | 🟡 中 | 需要 API 方式实现 |
| 无批量上传 | 🟡 中 | 需要逐个创建上传任务 |

### 8.2 潜在Bug

| 问题 | 严重程度 | 说明 |
|------|---------|------|
| 数据库路径问题 | ✅ 已修复 | 已修复，需验证 |
| 初始化错误不通知前端 | ✅ 已修复 | 已添加状态检查 |
| GORM 钩子函数签名 | ✅ 已修复 | 已修复数据库操作问题 |
| 登录超时问题 | ✅ 已修复 | 从60秒改为5分钟+状态检测 |

---

## 九、测试结论

### 9.1 核心功能状态

| 功能模块 | 状态 | 说明 |
|----------|------|------|
| 数据库操作 | 🟡 待验证 | 已修复路径和钩子问题 |
| 账号管理 | 🟡 待验证 | 支持6个平台 |
| 视频管理 | 🟡 待验证 | 依赖数据库 |
| 抖音上传 | 🟡 待验证 | 需要浏览器 |
| 视频号上传 | 🟡 待验证 | ✅ 已实现 |
| 快手上传 | 🟡 待验证 | ✅ 已实现 |
| TikTok上传 | 🟡 待验证 | ✅ 已实现 |
| 小红书上上传 | 🟡 待验证 | ✅ 已实现 |
| 百家号上传 | 🟡 待验证 | ✅ 已实现 |
| Bilibili上传 | ❌ 不支持 | 需要单独实现 |
| 定时调度 | 🟡 待验证 | 依赖数据库 |

### 9.2 已实现的平台

| 平台 | 状态 | 特殊功能 |
|------|------|---------|
| 抖音 (douyin) | ✅ 已实现 | 基础功能 |
| 视频号 (tencent) | ✅ 已实现 | 21字标题限制 |
| 快手 (kuaishou) | ✅ 已实现 | 文件选择器、3标签限制 |
| TikTok | ✅ 已实现 | iframe/普通容器双适配 |
| 小红书 (xiaohongshu) | ✅ 已实现 | 30字标题、新旧页面兼容 |
| 百家号 (baijiahao) | ✅ 已实现 | 重试机制 |
| Bilibili | ⏳ 待实现 | API 方式 |

### 9.3 建议

1. **优先测试数据库功能**，确认修复有效
2. **验证各平台完整流程**：登录 → 验证 → 上传
3. **Bilibili 实现**（长期规划）
4. **各平台页面元素可能变化**，需要持续维护
